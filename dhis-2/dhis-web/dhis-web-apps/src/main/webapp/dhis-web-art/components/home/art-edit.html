<h3>{{'edit_art'| translate}}</h3>
<div class="selection-group">
    <div class="col-sm-7 art-edit-area">
        <h4>{{'art_status'| translate}}</h4>
        <div class="row">
            <div class="col-sm-12">
                <div class="list-group col-sm-3">
                    <a ng-repeat="stage in model.selectedProgram.programStages" class="list-group-item cursor-pointer" ng-class="{true: 'active'} [stage.id === model.selectedStage.id]" ng-click="setSelectedStage(stage)">
                        {{stage.displayName}}
                    </a>
                </div>
                <div class="col-sm-9">
                    <div class="bordered-div" ng-if="model.selectedStage">
                        <table class="table table-responsive table-bordered table-striped">
                            <tr>
                                <th colspan="2">
                                    {{'details_of_state' | translate}} {{model.selectedStage.displayName}}
                                </th>
                            </tr>
                            <tr ng-repeat="psde in model.selectedStage.programStageDataElements" ng-init="de = model.dataElementsById[psde.dataElement.id]">
                                <td>
                                    {{de.displayName}}
                                </td>
                                <td>
                                    <ng-form name="innerStatusForm">
                                        <div ng-if="de.optionSetValue">
                                            <ui-select ng-model="model.art.recommendationStatus[model.selectedStage.id][de.id]"
                                                       ng-required="psde.mandatory"
                                                       name="foo"
                                                       theme="select2"
                                                       style="width:100%;">
                                                <ui-select-match allow-clear="true" class="form-control-ui-select" placeholder="{{model.optionSets[de.optionSet.id].options && model.optionSets[de.optionSet.id].options.length > 0 ? 'select_or_search' : 'empty'| translate}}">{{$select.selected.displayName|| $select.selected}}</ui-select-match>
                                                <ui-select-choices repeat="option.displayName as option in model.optionSets[de.optionSet.id].options | filter: $select.search | limitTo:maxOptionSize">
                                                    <span ng-bind-html="option.displayName | highlight: $select.search"></span>
                                                </ui-select-choices>
                                            </ui-select>
                                        </div>
                                        <div ng-if="!de.optionSetValue" ng-switch="de.valueType">
                                            <div ng-switch-when="NUMBER">
                                                <input type="number"
                                                       name="foo"
                                                       class="form-control pull-center"
                                                       ng-required="psde.mandatory"
                                                       ng-model="model.art.recommendationStatus[model.selectedStage.id][de.id]">
                                            </div>
                                            <div ng-switch-when="TEXT">
                                                <input type="text"
                                                       name="foo"
                                                       class="form-control pull-center"
                                                       ng-required="psde.mandatory"
                                                       ng-model="model.art.recommendationStatus[model.selectedStage.id][de.id]">
                                            </div>
                                            <div ng-switch-when="LONG_TEXT">
                                                <textarea rows="3"
                                                          name="foo"
                                                          class="form-control pull-center"
                                                          ng-required="psde.mandatory"
                                                          ng-model="model.art.recommendationStatus[model.selectedStage.id][de.id]">
                                                </textarea>
                                            </div>
                                            <div ng-switch-when="DATE">
                                                <input type="text"
                                                       ng-attr-placeholder="{{dhis2CalendarFormat.keyDateFormat}}"
                                                       name="foo"
                                                       class="form-control pull-center"
                                                       d2-date
                                                       ng-required="psde.mandatory"
                                                       ng-model="model.art.recommendationStatus[model.selectedStage.id][de.id]"/>
                                            </div>
                                        </div>
                                        <span ng-messages="innerStatusForm.foo.$error" ng-if="interacted(innerStatusForm.foo)" class="required" ng-messages-include="../dhis-web-commons/angular-forms/error-messages.html"></span>
                                    </ng-form>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-sm-5 art-edit-area">
        <h4>{{'art_profile'| translate}}</h4>
        <table class="table table-responsive table-bordered table-striped">
            <tr>
                <td>
                    {{'recommendation_date'| translate}}
                </td>
                <td>
                    <input type="text"
                           ng-attr-placeholder="{{dhis2CalendarFormat.keyDateFormat}}"
                           name="enrollmentDate"
                           class="form-control hideInPrint"
                           d2-date
                           ng-model="model.art.enrollmentDate"
                           ng-required="true"/>
                    <span ng-show="outerForm.submitted && outerForm.enrollmentDate.$invalid" class="error">{{'required'| translate}}</span>
                </td>
            </tr>
            <tr ng-repeat="pat in model.selectedProgram.programTrackedEntityAttributes" ng-init="att = model.trackedEntityAttributes[pat.trackedEntityAttribute.id]">
                <td>
                    {{att.displayName}}
                </td>
                <td>
                    <ng-form name="innerProfileForm">
                        <div ng-if="att.optionSetValue">
                            <ui-select ng-model="model.art.attributeValues[att.id]"
                                       ng-required="pat.mandatory"
                                       name="foo"
                                       theme="select2"
                                       style="width:100%;">
                                <ui-select-match allow-clear="true" class="form-control-ui-select" placeholder="{{model.optionSets[att.optionSet.id].options && model.optionSets[att.optionSet.id].options.length > 0 ? 'select_or_search' : 'empty'| translate}}">{{$select.selected.displayName|| $select.selected}}</ui-select-match>
                                <ui-select-choices repeat="option.displayName as option in model.optionSets[att.optionSet.id].options | filter: $select.search | limitTo:maxOptionSize">
                                    <span ng-bind-html="option.displayName | highlight: $select.search"></span>
                                </ui-select-choices>
                            </ui-select>
                        </div>
                        <div ng-if="!att.optionSetValue" ng-switch="att.valueType">
                            <div ng-switch-when="NUMBER">
                                <input type="number"
                                       name="foo"
                                       class="form-control pull-center"
                                       ng-required="pat.mandatory"
                                       ng-model="model.art.attributeValues[att.id]">
                            </div>
                            <div ng-switch-when="TEXT">
                                <input type="text"
                                       name="foo"
                                       class="form-control pull-center"
                                       ng-required="pat.mandatory"
                                       ng-model="model.art.attributeValues[att.id]">
                            </div>
                            <div ng-switch-when="LONG_TEXT">
                                <textarea rows="3"
                                          name="foo"
                                          class="form-control pull-center"
                                          ng-required="pat.mandatory"
                                          ng-model="model.art.attributeValues[att.id]">
                                </textarea>
                            </div>
                            <div ng-switch-when="DATE">
                                <input type="text"
                                       ng-attr-placeholder="{{dhis2CalendarFormat.keyDateFormat}}"
                                       name="foo"
                                       class="form-control pull-center"
                                       d2-date
                                       ng-required="pat.mandatory"
                                       ng-model="model.art.attributeValues[att.id]"/>
                            </div>
                        </div>
                        <span ng-messages="innerProfileForm.foo.$error" ng-if="interacted(innerProfileForm.foo)" class="required" ng-messages-include="../dhis-web-commons/angular-forms/error-messages.html"></span>
                    </ng-form>
                </td>
            </tr>
        </table>
    </div>
</div>
<button type="button"
        class="btn btn-info"
        ng-click="updateArt()">
    {{'update'| translate}}
</button>
<button type="button"
        class="btn btn-danger horizontal-spacing"
        ng-click="cancelEdit()">
    {{'cancel'| translate}}
</button>